@inherits LayoutComponentBase
@using AntDesign
@using GameManagement.Components.Pages
@using GameManagement.SpecialComponent
@using GameManagement.SpecialComponent.ExtensionClass;
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthToken
<HeadContent>
    <link href="_content/AntDesign/css/ant-design-blazor.css" rel="stylesheet" />
</HeadContent>
<div class="page">
    <div class="sidebar">
        <CascadingValue Value="Data">
            <NavMenu HaveLogged="isLoggedIn"></NavMenu>
        </CascadingValue>
    </div>
    <main>
        <div class="top-row px-4">
            <AuthorizeView>
                <Authorized Context="auth">
                    <AntDesign.Text>Xin chào, @currentUser</AntDesign.Text>
                    <a href="#" class="ms-3" @onclick="LogoutAccount">Đăng xuất</a>
                </Authorized>
                <NotAuthorized>
                    <a href="#" @onclick="ShowLoginModal">Đăng nhập</a>
                </NotAuthorized>
            </AuthorizeView>
        </div>
        <article class="content">
            @Body
        </article>
    </main>
</div>
<script src="_content/AntDesign/js/ant-design-blazor.js"></script>

<Modal Visible="loginVisible"
       Title="ĐĂNG NHẬP LIỀN"
       Footer="@null" MaskClosable=true
       OnCancel="() => loginVisible = false">
    <EditForm Model="@EditModel" OnValidSubmit="@HandleLoginAsync">
        <Row>
            <LabelFor For="() => EditModel.UserName"></LabelFor>
            <Input @bind-Value="@EditModel.UserName" />
            <ValidationMessage For="() => EditModel.UserName"></ValidationMessage>
        </Row>
        <Row>
            <LabelFor For="() => EditModel.PassWord"></LabelFor>
            <AntDesign.InputPassword @bind-Value="@EditModel.PassWord" />
            <ValidationMessage For="() => EditModel.PassWord"></ValidationMessage>
        </Row>
        <Row>
            Bạn chưa có tài khoản?
            <a href="#" @onclick="RegisterAccount">Click here</a>
        </Row>
        <Row>
            @if (error)
            {
                <AntDesign.Text Style="color:red;">Vui lòng nhập tên đăng nhập hoặc mật khẩu</AntDesign.Text>
            }
        </Row>
        <Row Gutter="8" Justify="@RowJustify.End">
            <Space>
                <SpaceItem>
                    <Button HtmlType="submit" Type="@ButtonType.Primary">Đăng nhập</Button>
                </SpaceItem>
            </Space>
        </Row>
    </EditForm>
</Modal>

<Modal Visible="registerVisible"
       Title="ĐĂNG KÍ TÀI KHOẢN"
       Footer="@null" MaskClosable=true
       OnCancel="CloseRegisterForm">
    <EditForm Model="@EditModel" OnValidSubmit="@HandleRegisterAsync">
        <DataAnnotationsValidator />
        <InputWatcher @ref="inputWatcher"></InputWatcher>
        <Row>
            <LabelFor For="() => EditModel.UserName"></LabelFor>
            <Input Type="@InputType.Text" @bind-Value="@EditModel.UserName" />
            <ValidationMessage For="() => EditModel.UserName"></ValidationMessage>
        </Row>
        <Row>
            <LabelFor For="() => EditModel.PassWord"></LabelFor>
            <AntDesign.InputPassword @bind-Value="@EditModel.PassWord" />
            <ValidationMessage For="() => EditModel.PassWord"></ValidationMessage>
        </Row>
        <Row>
            <LabelFor For="() => EditModel.Name"></LabelFor>
            <Input Type="@InputType.Text" @bind-Value="@EditModel.Name" />
            <ValidationMessage For="() => EditModel.Name"></ValidationMessage>
        </Row>
        <Row>
            <LabelFor For="() => EditModel.Email"></LabelFor>
            <Input Type="@InputType.Text" @bind-Value="@EditModel.Email" />
            <ValidationMessage For="() => EditModel.Email"></ValidationMessage>
        </Row>
        <Row Gutter="8" Justify="@RowJustify.Center">
            <Space>
                <SpaceItem>
                    <Button Style="margin-top:20px;" HtmlType="submit" Type="@ButtonType.Primary">Đăng kí</Button>
                </SpaceItem>
            </Space>
        </Row>
        <Row Gutter="8" Justify="@RowJustify.Center">
            <a href="#" @onclick="BackToLogin">Quay lại đăng nhập</a>
        </Row>
    </EditForm>
</Modal>

<AntContainer /> @* // them cái này ms có thông báo ở góc *@